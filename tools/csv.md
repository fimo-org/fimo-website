---
label: fimo-csv
icon: file-code
---

# fimo-csv (file-mongo-csv)

**fimo-csv** is a fast and flexible CLI tool written in Rust that imports CSV file into MongoDB documents using YAML-based field mappings and Jinja2-style templating. It's ideal for bulk inserts, updates, and upserts with full control over document structure.

---

## ğŸš€ Features

- âœ… RFC 4180-compliant CSV parsing (including headers, quoting, escaped quotes)
- ğŸ› ï¸ Field mapping via YAML configuration
- ğŸ§  Custom transformation logic using [MiniJinja](https://docs.rs/minijinja/)
- ğŸ” Supports complex templated pipelines for update and upsert operations, enabling aggregation logic and fine-grained control over MongoDB document modifications.
- ğŸ“¦ MongoDB insert, update, and upsert support
- ğŸ§ª Validate-only and dry-run modes
- ğŸ”„ Batch processing support for large files
- ğŸ” Supports Extended JSON and BSON types
- ğŸ”£ Configurable CSV delimiter and quote characters
- ğŸ“Š Debug and verbose output for development and testing
- ğŸ“… **NEW**: Flexible date parsing with multiple format support (e.g. ISO, MSSQL, Oracle, Go)

---

## ğŸ“¦ Installation

```bash
cargo install fimo-csv

```

Or clone and build:

```bash
git clone https://github.com/fimo-org/fimo-csv.git
cd fimo-csv
cargo build --release

````

## ğŸ“ Usage

```bash
fimo-csv \
  --input tests/data/extended.csv \
  --mapping tests/mapping/extended.yaml \
  --template-dir tests/templates \
  --mongo-uri mongodb://localhost:27017 \
  --db testdb \
  --collection testcol \
  --operation upsert \
  --extended-json \
  --debug
```
### ğŸ§ª Example: With Templates and Extended JSON

ğŸ“ data.csv
```csv
_id,price,created_at,name,active
507f1f77bcf86cd799439011,12.34,2024-01-01T10:00:00Z,Alice,yes
```

ğŸ§© mapping.yaml
```yaml
_id:
  type: objectId
price:
  type: decimal
created_at:
  type: date
name:
  type: string
active:
  type: bool
  truthy: ["yes", "true", "1", "Y"]
  falsy: ["no", "false", "0", "N"]
````

ğŸ§¾ templates/upsert.j2
```json
{
  "filter": { "_id": {{ row._id }} },
  "update": {
    "$set": {
      "price": {{ row.price }},
      "created_at": {{ row.created_at }},
      "name": "{{ row.name }}",
      "active": {{ row.active }}
    },
    "$setOnInsert": {
      "created_at": {{ row.created_at }}
    }
  }
}
```

â–¶ï¸ Run the Import
```bash
fimo-csv \
  --input data.csv \
  --mapping mapping.yaml \
  --template-dir templates \
  --mongo-uri mongodb://localhost:27017 \
  --db testdb \
  --collection customers \
  --operation upsert \
  --extended-json
```

### ğŸ§ª Example: Raw Insert (No Templates)
ğŸ“ simple.csv
```csv
name,age,active
Bob,25,true

```

ğŸ§© simple.yaml
```yaml
name:
  type: string
age:
  type: int
active:
  type: bool
```

â–¶ï¸ Raw Insert Command
```bash
fimo-csv \
  --input simple.csv \
  --mapping simple.yaml \
  --mongo-uri mongodb://localhost:27017 \
  --db demo \
  --collection people \
  --operation insert \
  --raw-insert
```



## ğŸ”§ CLI Options


| Option            | Description                                  |
| ------------------- | ---------------------------------------------- |
| `--input`         | Path to the CSV file                         |
| `--mapping`       | Path to YAML mapping file                    |
| `--mongo-uri`     | MongoDB connection URI                       |
| `--db`            | MongoDB database name                        |
| `--collection`    | MongoDB collection name                      |
| `--operation`     | `insert`, `update`, or `upsert`              |
| `--batch-size`    | Number of docs to write in bulk (default: 0) |
| `--no-header`     | Use autogenerated headers`col_0`, `col_1`... |
| `--delimiter`     | CSV delimiter (default:`,`)                  |
| `--quote`         | CSV quote character (default:`"`)            |
| `--template-dir`  | Directory with Jinja templates               |
| `--extended-json` | Enable support for non-JSON BSON values      |
| `--validate-only` | Validate rows without writing to MongoDB     |
| `--dry-run`       | Print documents instead of inserting         |
| `--debug`         | Enable verbose output                        |

## ğŸ§  Truthy/Falsy Mapping for Booleans

In mapping.yaml, you can define per-field truthy/falsy values:
```yaml
active:
  type: bool
  truthy: ["yes", "1", "true"]
  falsy: ["no", "0", "false"]
```

This allows more natural mapping from "yes"/"no", "Y"/"N" strings into true/false.

## ğŸ§  Flexible Date Parsing with Custom Formats
Fimo supports parsing date strings using custom formats, giving you the flexibility to import dates from a wide range of sources such as Oracle, MSSQL, or ISO standards.

You can define multiple formats for a date field in your mapping file:

```yaml
created_at:
  type: date
  formats:
    - "%Y-%m-%dT%H:%M:%S%.fZ"                # ISO 8601
    - "%Y-%m-%d %H:%M:%S"                    # MSSQL style
    - "%Y-%m-%d %H:%M:%S%.f"                 # Go-style (chrono-compatible)
    - "%Y/%m/%d %H:%M"                       # Custom
```
Fimo will try each format in order until one matches. This makes importing data from diverse systems much easier.

### â–¶ï¸ Example CSV
```csv
name,created_at
Alice,2024-01-01T10:00:00Z
Bob,2024-01-01 10:00:00
```
### â–¶ï¸ Corresponding Mapping
```yaml
name:
  type: string
created_at:
  type: date
  formats:
    - "%Y-%m-%dT%H:%M:%S%.fZ"
    - "%Y-%m-%d %H:%M:%S"
```

This feature leverages the chrono crate for robust and standards-compliant date parsing.

> â„¹ï¸ You can define multiple formats for a `date` field in the `formats` array. If omitted, Fimo defaults to parsing using RFC 3339 (e.g. `2024-01-01T10:00:00Z`).


## ğŸ“ Project Structure
```pgsql
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs             # CLI entry point
â”‚   â”œâ”€â”€ cli.rs              # Command-line argument parsing
â”‚   â”œâ”€â”€ mongo.rs            # MongoDB connection
â”‚   â”œâ”€â”€ transform.rs        # Mapping, templating, BSON conversion
â”‚   â”œâ”€â”€ mapping.rs          # YAML field type parsing
â”‚   â””â”€â”€ template.rs         # Jinja environment loader
â”œâ”€â”€ mappings/               # Sample mapping YAML files
â”œâ”€â”€ templates/              # Sample Jinja templates
â”œâ”€â”€ tests/                  # Sample CSV input for testing
â””â”€â”€ Cargo.toml              # Project manifest
```

## ğŸ“š RFC 4180 Compatibility

Fimo is fully compatible with RFC 4180:

* Comma-separated fields (configurable)
* Quoted fields with escape support
* Optional headers
* Uniform field count (recommended but not enforced)

---

## âš ï¸ Disclaimer

**fimo-csv is not affiliated with MongoDB Inc.**  
MongoDBÂ® is a registered trademark of MongoDB Inc.

---

## ğŸ“œ License

MIT Â© 
